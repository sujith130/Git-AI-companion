<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Dev Companion</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1724;
      --muted:#9aa4bf;
      --accent:#5b6cff;
      --bubble-user:#1f2937;
      --bubble-ai:#111827;
      --text:#e6eef8;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#06070b, #0b1020);font-family:Inter,system-ui,Segoe UI,Arial;color:var(--text);display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
    .container{width:420px;max-width:100%;height:90vh;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    header{padding:18px 20px;display:flex;align-items:center;gap:12px;background:transparent}
    .avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#7c83ff,#4fd1c5);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:16px;margin:0}
    .sub{font-size:12px;color:var(--muted);}
    .main{display:flex;height:calc(100% - 72px)}
    .sidebar{width:130px;padding:12px;border-right:1px solid rgba(255,255,255,0.02);background:transparent}
    .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;margin-bottom:12px;cursor:pointer}
    .card h3{margin:0;font-size:13px}
    .card p{margin:6px 0 0 0;font-size:12px;color:var(--muted)}
    .chat{flex:1;display:flex;flex-direction:column;justify-content:space-between;padding:12px}
    .messages{flex:1;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:10px}
    .bubble{max-width:75%;padding:12px;border-radius:12px;line-height:1.4;font-size:14px}
    .ai{align-self:flex-start;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .user{align-self:flex-end;background:linear-gradient(180deg, rgba(91,108,255,0.12), rgba(91,108,255,0.06));border:1px solid rgba(91,108,255,0.18);color:var(--text)}
    .input-area{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,0.02)}
    .input{flex:1;padding:12px;border-radius:999px;background:var(--card);border:1px solid rgba(255,255,255,0.03);color:var(--text);outline:none}
    .send{background:var(--accent);border:none;padding:10px 14px;border-radius:999px;color:white;cursor:pointer}
    footer{padding:10px;background:transparent}
    code{background:rgba(255,255,255,0.03);padding:6px;border-radius:6px;display:block}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="avatar">AI</div>
      <div>
        <h1>AI Dev Companion</h1>
        <div class="sub">Project assistant & PR reviewer</div>
      </div>
    </header>
    <div class="main">
      <div class="sidebar">
        <div class="card" onclick="startMode('chat')"><h3>New Chat</h3><p>Ask about architecture, tests, performance</p></div>
        <div class="card" onclick="startMode('optimize')"><h3>Optimize</h3><p>Get optimization tips</p></div>
        <div class="card" onclick="startMode('review')"><h3>PR Review</h3><p>Paste PR diff or ask for review</p></div>
      </div>
      <div class="chat">
        <div id="messages" class="messages">
          <div class="bubble ai">Welcome! Choose a card to start or type a question.</div>
        </div>
        <div class="input-area">
          <input id="prompt" class="input" placeholder="Ask the AI about your project..." />
          <button id="send" class="send">Send</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('send');
    const promptInput = document.getElementById('prompt');
    const messagesEl = document.getElementById('messages');
    let mode = 'chat';

    function addBubble(text, who='ai'){
      const d = document.createElement('div');
      d.className = 'bubble ' + (who==='ai'?'ai':'user');
      d.textContent = text;
      messagesEl.appendChild(d);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function startMode(m){
      mode = m;
      addBubble("Mode switched to: " + mode, 'ai');
    }

    async function sendPrompt(){
      const prompt = promptInput.value.trim();
      if(!prompt) return;
      addBubble(prompt,'user');
      promptInput.value='';
      try{
        const res = await fetch('/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({prompt, mode})
        });
        let text = '';
        if(res.ok){
          const data = await res.json();
          text = data.response || 'No response from AI';
        }else{
          let err = 'Error ' + res.status;
          try{ const e = await res.json(); err += ': ' + (e.detail || JSON.stringify(e)); }catch{}
          text = err;
        }
        addBubble(text,'ai');
      }catch(e){
        addBubble('Error contacting AI: ' + e.message,'ai');
      }
    }

    sendBtn.onclick = sendPrompt;
    promptInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter') sendPrompt(); });
  </script>
</body>
</html>
